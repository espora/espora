<!DOCTYPE html>
<html>
	<head>
		<title>Espora</title>
		<%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
		<%= javascript_include_tag "application", "data-turbolinks-track" => true %>
		<%= favicon_link_tag "favicon.ico" %>
		<%= csrf_meta_tags %>
	</head>
	<body>

		<!-- CONTENEDOR PRINCIPAL -->
		<div id="ter-main-container">

			<!-- BANNER -->
			<div id="ter-header">

				<!-- PACIENTE ACTUAL -->
				<div id="ter-curr-patient" style="width: 30%;">
					<% if !current_patient.nil? %>
						<span style="margin-top: 38px;">
							<b>EXPEDIENTE ELEGIDO:</b> <%= current_patient.full_name %>
						</span>
						<span>
							<b>PRÓXIMA CITA:</b> <%= current_patient.patient_record.next_appointment_date %>
						</span>
						<span style="margin-top: 3px;">
							<%= link_to close_record_path do %>Cerrar Expediente<% end %>
						</span>
					<% else %>
						<span style="margin-top: 57px;">
							<b>NO SE TIENE ELEGIDO UN<br>EXPEDIENTE</b>
						</span>
					<% end %>
				</div>

				<!-- LOGO -->
				<div style="width: 70%;">
					<%= image_tag("Espora.png", :class => "ter-logo") %>
				</div>

				<% if not flash[:notice].nil? %>
					<!-- MENSAJES DEL TERAPEUTA -->
					<div class="alert-box success" style="width: 100%; margin: 5px 0 3px 0; padding: 10px 0px 10px 10px;" onclick="$(this).remove();">
						<%= flash[:notice] %>
					</div>
				<% end %>
			</div>

			<!-- WORKSPACE TERAPEUTA -->
			<div id="ter-tabs">
			
				<!-- OPCIONES PESTAÑA -->
				<ul>
					<li><a href="#perfil"><i class="fa fa-user"></i> Perfil</a></li>
					<li><a href="#lue">LUE</a></li>
					<li><a href="#havad">HAVAD</a></li>
					<% if current_therapist.role == "Coordinator" %>
						<li><a href="#add_therapist">Registra Terapeuta</a></li>
					<% end %>

					<!-- SALIR -->
					<div id="ter-logout">
						<%= link_to destroy_therapist_session_path, method: :delete do %>SALIR<% end %>
					</div>
				</ul>

				<!-- PERFIL -->
				<div id="perfil" class="ter-panel">
					<%= content_for?(:profile_tab) ? yield(:profile_tab) : "" %>
				</div>

				<!-- LUE PANEL -->
				<div id="lue" class="ter-panel">
					<%= content_for?(:lue_tab) ? yield(:lue_tab) : "" %>
				</div>

				<!-- HAVAD PANEL -->
				<div id="havad" class="ter-panel">
					<%= content_for?(:havad_tab) ? yield(:havad_tab) : "" %>
				</div>

				<% if current_therapist.role == "Coordinator" %>

					<!-- REGISTRAR TERAPEUTA -->
					<div id="add_therapist">
						<%= content_for?(:new_therapist_tab) ? yield(:new_therapist_tab) : "" %>
					</div>
				<% end %>
			</div>
		</div>

		<script type="text/javascript">
			$(document).ready(function() {
				
				$( "#ter-tabs" ).tabs({
					active: parseInt("<%= @therapist_active_tab %>"),
					beforeActivate: function( event, ui ) {

						// Siguiente panel
						var newPanel = ui.newPanel;

						// PANEL AL WORKSPACE

						// Perfil
						if( newPanel.attr( "id" ) == "perfil" ) {
							window.location = "<%= therapist_profile_path(current_therapist.id) %>";
						}

						// LUE
						if( newPanel.attr( "id" ) == "lue" ) {
							window.location = "<%= lue_index_path %>";
						}

						//HAVAD
						if( newPanel.attr( "id" ) == "havad" ) {
							window.location = "<%= havad_index_path %>";
						}

						// Agregar terapeuta
						if( newPanel.attr( "id" ) == "add_therapist" ) {
							window.location = "<%= (current_therapist.role == 'Coordinator') ? new_therapist_path : '' %>"
						}
					}
				});

			});
		</script>
	</body>
</html>
