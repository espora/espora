<% content_for :havad do %>

	<script type="text/javascript">
		
		function changeMechanism ( input ) {

			var idMechanism = $(input).attr("id-mechanism");

			if( input.checked ) {

				// Creamos el hidden input
				var hidden = document.createElement("input");
				$(hidden).attr("type", "hidden");

				// Lo seteamos con el nombre, id y valor
				$(hidden).attr("id", "patient_record_mechanism_types_attributes_" + idMechanism + "_id");
				$(hidden).attr("name", "patient_record[mechanism_types_attributes][" + idMechanism + "][id]");
				$(hidden).val(idMechanism);

				// Lo agregamos al div de mecanismo
				$(input).parent().append(hidden);
			}
			else {

				// Localizamos al hidden input y lo quitamos
				var hidden = $("#patient_record_mechanism_types_attributes_" + idMechanism + "_id");
				if(hidden.length > 0) {
					hidden.remove();
				}
			}
		}

		function changeExperience ( input ) {

			var idExperiece = $(input).attr("id-experiece");

			if( input.checked ) {

				// Creamos el hidden input
				var hidden = document.createElement("input");
				$(hidden).attr("type", "hidden");

				// Lo seteamos con el nombre, id y valor
				$(hidden).attr("id", "patient_record_experience_types_attributes_" + idExperiece + "_id");
				$(hidden).attr("name", "patient_record[experience_types_attributes][" + idExperiece + "][id]");
				$(hidden).val(idExperiece);

				// Lo agregamos al div de mecanismo
				$(input).parent().append(hidden);
			}
			else {

				// Localizamos al hidden input y lo quitamos
				var hidden = $("#patient_record_experience_types_attributes_" + idExperiece + "_id");
				if(hidden.length > 0) {
					hidden.remove();
				}
			}
		}
	</script>

	<!--FORMULARIO HAVAD -->
	<div class="form-inputs" style="width: 47%; margin-left: 2%; margin-top: 5px;">
		<%= nested_form_for current_patient.patient_record do | record_form | %>

			<!--Familiograma (¿Con quien vive?)-->
			<div style="font-weight: bold; font-size: 13px; margin-bottom: 17px;">
				FAMILIOGRAMA
			</div>
			<div style="margin-left: 4%; margin-top: -5px; margin-bottom: 30px;">
				<%= record_form.label :lives_with do %>¿Con quien vives?: <% end %>
				<%= record_form.text_field :lives_with, autofocus: true, :size => 50, :required => true, :maxlength => 25 %>
			</div>

			<!-- RASGOS PADRES -->
			<div style="font-weight: bold; font-size: 13px; margin-bottom: 3px; margin-top: 15px;">
				RASGOS PADRES
			</div>
			<div style="margin-top: 5px; margin-left: 25px; ">

				<!-- CAMPOS PARA PARA LA MADRE -->
				<% mother_trait = record_form.object.paternal_traits.where(:from_mother => true).first  %>
				<%= record_form.fields_for mother_trait do | mother_form | %>
					<div style="margin-left: 0%; margin-top: 5px; float:left">
						<%= mother_form.label :patient_record_id do %>Madre: <% end %>
						<%= mother_form.select :patient_record_id, PaternalTraitType::options_for_select %>
					</div>
				<% end %>
				
				<!-- CAMPOS PARA PARA EL PADRE -->
				<% father_trait = record_form.object.paternal_traits.where(:from_mother => false).first  %>
				<%= record_form.fields_for father_trait do | father_form | %>
					<div style="margin-left: 2%; margin-top: 5px; float:left; margin-bottom: 30px">
						<%= father_form.label :patient_record_id do %>Padre: <% end %>
						<%= father_form.select :patient_record_id, PaternalTraitType::options_for_select %>
					</div>
				<% end %>
			</div>

			<br><br>

			<!-- CIE10 -->
			<div style="font-weight: bold; font-size: 13px; width: 50px">
				<%= record_form.label :cie10_type_id do %>CIE10: <% end %>
			</div>
			<div style="margin-top: 5px; margin-left: 25px; margin-bottom: 30px;">
				<%= record_form.select :cie10_type_id, Cie10Type::options_for_select %>
			</div>

			<!-- MECANISMOS-->
			<div style="font-weight: bold; font-size: 13px; margin-top: 5px;">
				MECANISMOS
			</div>
			<div style="margin-top: 5px; margin-left: 25px;">
				<% record_form.object.mechanism_types.each do | mechanism_type | %>
					<% name_input = "patient_record[mechanism_types_attributes]["+mechanism_type.id.to_s+"][id]" %>
					<%= hidden_field_tag name_input, mechanism_type.id.to_s %>
				<% end %>

				<% MechanismType.all.each do | mechanism_type | %>
					<input type='checkbox' id-mechanism=<%= mechanism_type.id %> onchange='changeMechanism(this);' <% if record_form.object.mechanism_types.include?(mechanism_type) %>checked<% end %>>
					<%= label_tag 'mechanism_type_name', mechanism_type.name %>
				<br>
				<% end %>
			</div>

			<!-- SITUACIONES Y EXPERIENCIAS -->
			<div style="font-weight: bold; font-size: 13px; margin-left:55%; margin-top: -362px;">
				SITUACIONES Y EXPERIENCIAS
			</div>
			<div style="margin-top: 5px; margin-left: 55%;">
				<% record_form.object.experience_types.each do | experience_type | %>
					<% name_input = "patient_record[experience_types_attributes]["+experience_type.id.to_s+"][id]" %>
					<%= hidden_field_tag name_input, experience_type.id.to_s %>
				<% end %>

				<% ExperienceType.all.each do | experience_type | %>
					<input type='checkbox' id-experiece=<%= experience_type.id %> onchange='changeExperience(this);' <% if record_form.object.experience_types.include?(experience_type) %>checked<% end %>>
					<%= label_tag 'experience_type_name', experience_type.name %>
				<br>
				<% end %>
			</div>

			<!-- ESTRUCTURA CLINICA-->
			<div style=" font-weight: bold; font-size: 13px;margin-left: 0%; margin-top: 80px;">
				<%= record_form.label :clinical_structure_type_id do %>ESTRUCTURA CLINICA: <% end %>
			</div>
			<div style=" font-weight: bold; font-size: 13px;margin-left: 0%; margin-top: 10px; margin-bottom: 50px;">
				<%= record_form.select :clinical_structure_type_id, ClinicalStructureType::options_for_select %>
			</div>
		<% end %>
	</div>
<% end %>

<%= render template: "patient_records/havad_tab" %>